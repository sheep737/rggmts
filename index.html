<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Pinball Complete</title>
<style>
  body {
    margin: 0;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: #0f0;
    font-family: monospace;
  }
  canvas {
    background: #000;
    border: 4px solid #0f0;
  }
</style>
</head>
<body>

<canvas id="game" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let score = 0;
let gameOver = false;

// ボール
const ball = {
  x: 200,
  y: 100,
  r: 8,
  vx: 2,
  vy: 0
};

const gravity = 0.35;

// フリッパー
const leftFlipper = { x: 120, y: 520, angle: 0 };
const rightFlipper = { x: 280, y: 520, angle: 0 };

// バンパー
const bumpers = [
  { x: 200, y: 250, r: 20 },
  { x: 150, y: 300, r: 15 },
  { x: 250, y: 300, r: 15 }
];

// 入力
let leftKey = false;
let rightKey = false;

document.addEventListener("keydown", e => {
  if (e.key === "a") leftKey = true;
  if (e.key === "l") rightKey = true;
  if (e.key === "r") location.reload();
});

document.addEventListener("keyup", e => {
  if (e.key === "a") leftKey = false;
  if (e.key === "l") rightKey = false;
});

function distance(a, b) {
  return Math.hypot(a.x - b.x, a.y - b.y);
}

// メインループ
function update() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (!gameOver) {
    // フリッパー角度
    leftFlipper.angle = leftKey ? -0.6 : 0;
    rightFlipper.angle = rightKey ? 0.6 : 0;

    // ボール物理
    ball.vy += gravity;
    ball.x += ball.vx;
    ball.y += ball.vy;

    // 壁
    if (ball.x < ball.r || ball.x > canvas.width - ball.r) ball.vx *= -1;
    if (ball.y < ball.r) ball.vy *= -1;

    // バンパー
    bumpers.forEach(b => {
      if (distance(ball, b) < ball.r + b.r) {
        ball.vy = -6;
        score += 100;
      }
    });

    // フリッパー衝突
    if (ball.y > 500 && ball.y < 540) {
      if (ball.x < 200 && leftKey) {
        ball.vy = -8;
        ball.vx = -3;
      }
      if (ball.x > 200 && rightKey) {
        ball.vy = -8;
        ball.vx = 3;
      }
    }

    // ゲームオーバー
    if (ball.y > canvas.height) {
      gameOver = true;
    }
  }

  // 描画：ボール
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
  ctx.fillStyle = "#fff";
  ctx.fill();

  // 描画：フリッパー
  drawFlipper(leftFlipper, true);
  drawFlipper(rightFlipper, false);

  // 描画：バンパー
  bumpers.forEach(b => {
    ctx.beginPath();
    ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
    ctx.fillStyle = "#0f0";
    ctx.fill();
  });

  // スコア
  ctx.fillStyle = "#0f0";
  ctx.fillText("SCORE: " + score, 10, 20);

  // ゲームオーバー表示
  if (gameOver) {
    ctx.fillText("GAME OVER", 150, 300);
    ctx.fillText("Press R to Restart", 120, 330);
  }

  requestAnimationFrame(update);
}

function drawFlipper(f, isLeft) {
  ctx.save();
  ctx.translate(f.x, f.y);
  ctx.rotate(f.angle);
  ctx.fillStyle = "#fff";
  ctx.fillRect(isLeft ? -60 : 0, -5, 60, 10);
  ctx.restore();
}

update();
</script>

</body>
</html>