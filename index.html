<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Simple Tower Defense</title>
<style>
  body {
    text-align: center;
    background: #f0f0f0;
  }
  canvas {
    background: #fff;
    border: 2px solid #333;
  }
</style>
</head>
<body>

<h2>シンプル タワーディフェンス</h2>
<p>クリックでタワーを設置</p>
<canvas id="game" width="800" height="400"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const enemies = [];
const towers = [];
const bullets = [];

let frame = 0;

// 敵生成
function spawnEnemy() {
  enemies.push({
    x: 0,
    y: 200,
    hp: 3,
    speed: 1
  });
}

// タワー設置
canvas.addEventListener("click", e => {
  const rect = canvas.getBoundingClientRect();
  towers.push({
    x: e.clientX - rect.left,
    y: e.clientY - rect.top,
    range: 120,
    cooldown: 0
  });
});

// 更新処理
function update() {
  frame++;

  if (frame % 120 === 0) spawnEnemy();

  // 敵移動
  enemies.forEach(e => e.x += e.speed);

  // タワー攻撃
  towers.forEach(t => {
    if (t.cooldown > 0) {
      t.cooldown--;
      return;
    }
    const target = enemies.find(e =>
      Math.hypot(e.x - t.x, e.y - t.y) < t.range
    );
    if (target) {
      bullets.push({
        x: t.x,
        y: t.y,
        target
      });
      t.cooldown = 60;
    }
  });

  // 弾移動
  bullets.forEach(b => {
    const dx = b.target.x - b.x;
    const dy = b.target.y - b.y;
    const dist = Math.hypot(dx, dy);
    b.x += dx / dist * 4;
    b.y += dy / dist * 4;

    if (dist < 5) {
      b.target.hp--;
      bullets.splice(bullets.indexOf(b), 1);
    }
  });

  // 敵削除
  for (let i = enemies.length - 1; i >= 0; i--) {
    if (enemies[i].hp <= 0 || enemies[i].x > 800) {
      enemies.splice(i, 1);
    }
  }
}

// 描画処理
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // 敵
  enemies.forEach(e => {
    ctx.fillStyle = "red";
    ctx.beginPath();
    ctx.arc(e.x, e.y, 10, 0, Math.PI * 2);
    ctx.fill();
  });

  // タワー
  towers.forEach(t => {
    ctx.fillStyle = "blue";
    ctx.fillRect(t.x - 10, t.y - 10, 20, 20);
  });

  // 弾
  bullets.forEach(b => {
    ctx.fillStyle = "black";
    ctx.beginPath();
    ctx.arc(b.x, b.y, 3, 0, Math.PI * 2);
    ctx.fill();
  });
}

// ゲームループ
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>